   Использование системы инсталляции MDF

1. Номерация версий

Номер версии представляет из себя 3-4 цифры, разделенные точками.
первая цифра означает стабильный релиз
вторая цифра предварительный (бета)
третья цифра просто билд.

причем при значении отличном от нуля предыдущие статусы теряются.
Если бета версия не ноль, значит пакет уже не релиз. всмысле не
настолько стабилен чтобы быть релизом. Если билд не ноль, значит и на
бету пакет тоже не тянет.

То есть правила такие:
?.0.0 - самая стабильная в это утро я.
?.?.0 - не самая но тем не менее.
?.?.? - только для разработчиков, по большому счету.

Причем у версий строгий порядок следования...
0.7.0, 1.0.7, 1.7.0, 7.0.0, 7.0.1 ...

(* в будующем появится фильтрация версий, но пока нету)

четвертая цифра обозначает уровень исправлений. На порядок версий не
влияет. Здесь правила еще проще... чем выше патчлевел, тем стабильнее
пакет. патчи по определению служат только для исправления ошибок.

2. Переменные окружения.

Предварительно, перед началом инсталляции должны быть описаны некоторые
переменные окружения и созданы соответствующие каталоги.

MDF_ROOT - Корневая директория устанавливаемой системы.
MDF_TREE - Дерево сборки системы.
MDF_FILES - Исходные файлы системы.
MDF_TEMP - Каталог для временных файлов. очищается при сборке,
        так что будьте внимательны.

MDF_REPOS - Репозиторий исходных текстов.
        Может быть использован для сборки билдов...
        Содержит в себе дерево сборки. и сборочные скрипты.

Пока система не собирается иначе как из репозитория.
Поэтому MDF_TREE может быть установлен в '$(MDF_REPOS)/Tree'


3. Сборка.

* Для работы скриптов необходим перл с установленным модулем DIGEST::SHA1

Для сборки и инсталляции необходимо подать команду

# $(MDF_REPOS)/Script/msetup <Имя пакета>

Все необходимые пакеты будут установлены автоматически.
В случае ошибок инсталляции обращайтесь ко мне. :)


        Для разработчиков


1. Соглашение о сборке MDF

В мейк файл всегда передаются три переменные окружения.

MDF_TEMP - здесь надо располагать любые временные файлы.
        файлы проекта неприкосновенны.

MDF_IMAGE - предположительно рут...
        но сборочному скрипту об этом ничего не известно.
        он просто инсталлирует все результирующие файлы проекта сюда
        в соответствующие каталоги.

VERSION - содержит версию собираемого пакета обрамленную апострофами.
        Это для внедрения в программы.

Текущий каталог неприкосновенен. сборка должна идти хоть с сидюка.
темп для свалки, имидж для результата.
И никаких предположений о взаиморасположении темпа и имиджа строить не надо.


2. Файлы описания проектов в дереве сборки (.msetup файлы)

Файлы надо описывать в xml.

Есть несколько идей по развитию.
Думаю, что каждый пакет стоит подразделить на компоненты. То есть отдельно
ставить бинарники, либы, доки, инклюды...

Просто на чистой системе инклюды не нужны например, следовательно их незачем
запихивать в архивы пакаджей. Доки тоже многим могут быть не нужны.

То есть надо придумать некие подцели...
System-Core/Kernel-0.2
System-Core/Kernel-include-0.2
System-Core/Kernel-docs-0.2

и тд... версия естественно одна на всех.

И тогда в зависимостях можно будет указывать конкретные зависимости, избегая
сборки и инсталляции несущественых вещей.

3. Файлы описания установленных пакетов (.mpackage файлы)

Надо тоже перевести в xml.

Располагаются в соответствии с группой в каталоге
$(MDF_ROOT)/Config/System/Package/



        Андрей Валяев (dron@infosec.ru)
        (с) 2000-2007 все права защищены.

